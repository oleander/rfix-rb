#!/usr/bin/env -S ruby -W0 --disable-all
# frozen_string_literal: true

require "rubygems"
# require 'bootsnap'
require "bundler"

# Bootsnap.setup(
#   cache_dir:            'tmp/cache',          # Path to your cache
#   development_mode:     'development', # Current working environment, e.g. RACK_ENV, RAILS_ENV, etc
#   load_path_cache:      true,                 # Optimize the LOAD_PATH with a cache
#   compile_cache_iseq:   true,                 # Compile Ruby code into ISeq cache, breaks coverage reporting.
#   compile_cache_yaml:   true                  # Compile YAML into a cache
# )

unless defined?(Rfix)
  if $PROGRAM_NAME.end_with?("exe/rfix")
    require "bundler/setup"
    Bundler.require(:test, :default)
  else
    lockfile = Bundler::LockfileParser.new(Bundler.default_lockfile.read)
    if (rfix = lockfile.specs.detect { |spec| spec.name == "rfix" })
      Gem.use_paths Gem.dir, Bundler.bundle_path.to_s, *Gem.path
      gem "rfix", rfix.version
    end
  end
end

require "rfix"

Rfix::CLI::Command.setup
