#!/usr/bin/env -S ruby -W0 --disable-all
# frozen_string_literal: true

require "rubygems"
require "bundler"

unless defined?(Rfix)
  if $PROGRAM_NAME.end_with?("exe/rfix")
    require "bundler/setup"
    Bundler.require(:test, :default)
  else
    lockfile = Bundler::LockfileParser.new(Bundler.default_lockfile.read)
    if (rfix = lockfile.specs.detect { |spec| spec.name == "rfix" })
      Gem.use_paths Gem.dir, Bundler.bundle_path.to_s, *Gem.path
      gem "rfix", rfix.version
    end
  end
end

require "rfix"

Rfix::CLI::Command.setup
